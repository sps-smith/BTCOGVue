<div id="appMinistry">
    <btcog-ministries></btcog-ministries>
    <btcog-ministry></btcog-ministry>  
</div>


<script src="https://unpkg.com/vuex"></script>
<script src="//unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
<script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>


<script>
Vue.directive('focus',{
    bind: function(){
        this.el.focus();
    }
});

var store = new Vuex.Store({
    state:{
        ministries:[
            { ID : 1,
              Title: "Children's Ministry",
              Image: "../siteassets/Images/childrens.png",
              Banner: "../siteassets/Images/children2.jpg",
              Leader: "Dana Leigh",
              LeaderPic: "../siteassets/Images/Dana_leigh1.jpg",
              Content: "BTCOG Children's Ministry is a child-centred ministry dedicated to laying the spiritual foundation that leads into a relationship with God through Jesus Christ.",
              Email: "psmith@btcog.ca",
              Component: "/Children/1"  },
            { ID : 2,
              Title: "Women's Ministry",
              Image: "../siteassets/Images/womens_ministry.jpg" ,
              Banner: "../siteassets/Images/ladiesministry.jpg",
              Leader: "Mother Joyce Walker",
              LeaderPic: "../siteassets/Images/motherwalker1.jpg",
              Content: "BTCOG Women's Ministry exists to encourage, equip, and strengthen women in their Christian faith. This ministry encourages women to be godly examples in their home, community, and their church.",
              Email: "psmith@btcog.ca",
              Component: "/Children/2"  },
            { ID : 3,
              Title: "Christian Education",
              Image: "../siteassets/Images/christian_education.jpg",
              Banner: "../siteassets/Images/christianeducation2.jpg",
              Leader: "Pastor O'Neil Walker",
              LeaderPic: "../siteassets/Images/oneil1.jpg",
              Content: "BTCOG Christian Education program consists of theologically-based teaching of the bible and the Christian way of life. The teachers aspire to inspire students to believe that God's word is the final authority on the meaning of life and direction for holy living. Adherence to His principles are taught and are encouraged. Students and teachers alike, declare every week, that they are \"God's wondrous treasure; powerful beyond measure\".",
              Email: "psmith@btcog.ca",
              Component: "/Children/3"  },
            { ID : 4,
              Title: "Men's Ministry",
              Image: "../siteassets/Images/mens_ministry.jpg" ,
              Banner: "../siteassets/Images/btcogmens.jpg",
              Leader: "Donavon Rhoden",
              LeaderPic: "../siteassets/Images/placeholder-man.jpg",
              Content: "BTCOG Men's Ministry exhorts men to be of spiritual substance, led by the motto: \"Touching others: one life at a time\". This ministry advocates spiritual growth in their moral fabric and encourages the men to embrace the leadership role they were made to uphold.",
              Email: "psmith@btcog.ca",
              Component: "/Children/4"  },
            { ID : 5,
              Title: "Evangelism",
              Image: "../siteassets/Images/evangelism.jpg",
              Banner: "../siteassets/Images/evangelism1.jpg",
              Leader: "Evg. Maniram Roopnarine",
              LeaderPic: "../siteassets/Images/maniram.jpg",
              Content: "Evangelism is the heart of BTCOG to reach the un-churched and unsaved, while maturing believers with the gospel of Jesus Christ. Through the medium of home bible studies, prayer meetings, tract ministry, and quarterly revival service (Love Crusades), BTCOG fulfills the Great Commission, presenting the gospel in a relevant and strategic manner.",
              Email: "psmith@btcog.ca",
              Component: "/Children/5"  },
            { ID : 6,
              Title: "Media Ministry",
              Image: "../siteassets/Images/media-ministry-big.jpg",
              Banner: "../siteassets/Images/mediaministry3.jpg",
              Leader: "Ministry Leader",
              LeaderPic: "../siteassets/Images/placeholder-man.jpg",
              Content: "BTCOG Media Ministry aims to carry out the gospel of Jesus Christ to our visually-driven, ever-changing world through the use of technology and media. Worship services/events are recorded as a devotional and outreach tool.",
              Email: "psmith@btcog.ca",
              Component: "/Children/6"  },
            { ID : 7,
              Title: "Youth Ministry",
              Image: "../siteassets/Images/youth_ministry.jpg",
              Banner: "../siteassets/Images/youth1.jpg",
              Leader: "Georgia Pryce",
              LeaderPic: "../siteassets/Images/georgia.jpg",
              Content: "BTCOG Youth Ministry invests in young people which enable them to reach their full God-created potential. Youth Ministry works to foster the total personal and spiritual growth of each young person and seeks to draw young people into responsible participation in the life, mission and work within the Christian and urban community.",
              Email: "psmith@btcog.ca",
              Component: "/Children/7"  },
            { ID : 8,
              Title: "Praise & Worship",
              Image: "../siteassets/Images/praise.jpg",
              Banner: "../siteassets/Images/praise_worship1.jpg",
              Leader: "Evg. Marlene Rhoden",
              LeaderPic: "../siteassets/Images/marlene1.jpg",
              Content: "",
              Email: "psmith@btcog.ca",
              Component: "/Children/8"  },
            { ID : 9,
              Title: "Music Ministry",
              Image: "../siteassets/Images/music_ministry.jpg",
              Banner: "../siteassets/Images/music1.jpg",
              Leader: "Pastor O'Neil Walker",
              LeaderPic: "../siteassets/Images/oneil21.jpg",
              Content: "The BTCOG Music Ministry plays an integral part in the worship service(s), producing quality music that glorifies God. Two components uphold this ministry: The Praise Team & House Band. The Praise Team The Praise & Worship team exists to minister to the Lord through praise and worship, to encourage and lead the congregation into the presence of the Lord, and to facilitate and create an atmosphere where the presence of the Lord can dwell.",
              Email: "psmith@btcog.ca",
              Component: "/Children/9"  },
            { ID : 10,
              Title: "Praise Dance Ministry",
              Image: "../siteassets/Images/praise_dance.jpg",
              Banner: "../siteassets/Images/triumphantinmotion.jpg",
              Leader: "Sophia Jackson",
              LeaderPic: "../siteassets/Images/sophiajackson1.jpg",
              Content: "",
              Email: "psmith@btcog.ca",
              Component: "/Children/10"  }
        ],
        ministriesSelected: false,
        currentMinistry:{},
        currentMinistryID:0,
        nextMinistryID: 0,
        prevMinistryID:0,
        nextMinistryTitle:"",
        prevMinistryTitle:""
  
    },
    getters:{
        btcogMinistries: function(state) {
            return state.ministries;
        },
        getNextMinistry: function (state) {
            return state.nextMinistryID;
        },
        getPrevMinistry: function (state) {
                return state.prevMinistryID;
        },
        ministriesSelected: function(state){
            return state.ministriesSelected;
        },
        getCurrentMinistry: function(state){
            return state.currentMinistry;
        },
        getCurrentMInistryID: function(state){
            return state.currentMinistryID;
        },
        getNextMinistryTitle: function(state){
            return state.nextMinistryTitle;
        },
        getPrevMinistryTitle: function(state){
            return state.prevMinistryTitle;
        }
    },
    mutations:{
        setMinistriesSelected: function(state, payload){
            state.ministriesSelected = payload;
        },
        setCurrentMinistry: function(state, payload){
            state.currentMinistry = payload;
        },
        setNextMinistryID: function(state, payload){
            state.nextMinistryID = payload;
        },
        setPrevMinistryID: function (state, payload) {
            state.prevMinistryID = payload;
        },
        setCurrentMinistryID: function(state, payload){
            state.currentMinistryID = payload;
        },
        setNextMinistryTitle: function(state, payload){
            state.nextMinistryTitle = payload;
        },
        setPrevMinistryTitle: function(state, payload){
            state.prevMinistryTitle = payload;
        }
    },
    actions:{
        getMinistryData: function(context, payload){
            context.commit("setCurrentMinistryID", payload);
            var data =  context.state.ministries.filter(function (ministry) {
                return ministry.ID === payload;
            });
            if (data != undefined)
            {
                context.commit("setCurrentMinistry", data);
                if (payload > 1 && payload < 10)
                {
                    context.commit("setNextMinistryID", payload + 1);
                    context.commit("setPrevMinistryID", payload - 1);
                }
                else
                {
                    if (payload == 1)
                    {
                        context.commit("setNextMinistryID", payload + 1);
                        context.commit("setPrevMinistryID", -1);
                    }
                    else if (payload == 10)
                    {
                      context.commit("setNextMinistryID", -1);
                      context.commit("setPrevMinistryID", payload - 1);
                    }
                }

                if (context.state.nextMinistryID > 0)
                {
                    var data =  context.state.ministries.filter(function (ministry) {
                        return ministry.ID === context.state.nextMinistryID;
                    });
                    if (data != undefined)
                        context.commit("setNextMinistryTitle", data[0].Title)
                }

                if (context.state.prevMinistryID > 0)
                {
                    var data =  context.state.ministries.filter(function (ministry) {
                        return ministry.ID === context.state.prevMinistryID ;
                    });
                    if (data != undefined)
                        context.commit("setPrevMinistryTitle", data[0].Title)
                }
            }  
        }
    }
});

var btcog = Vue.component("btcog-ministries",{
    template: '<div id="ministries" v-if="!ministries">\
                    <div class="ministryDetails" @click="getMinistry(item.ID)" v-for="item in churchMinistries" :title="item.Title">\
                        <div class="ministryImage"><img :src="item.Image" class="img-responsive" :alt="item.Title" />\
                        </div>\
                    </div>\
                </div>',
    computed: {
        churchMinistries: function churchMinistries() {
            return store.getters.btcogMinistries;
        },
        ministries: function(){
            return store.getters.ministriesSelected;
        }
    }, 
    methods: {
        getMinistry: function(payload){
            store.commit('setMinistriesSelected', true);
            store.dispatch('getMinistryData', payload);
        }
    }            
});

var children = Vue.component("btcog-ministry",{
    template: '<div id="ministry" v-if="ministries">\
                    <div class="banner" :style="{backgroundImage: HeaderImage}">\
                        <div class="h1div"><h1 class="hTitle">{{ ministry.Title }}</h1></div>\
                    </div>\
                    <div class="ministrydiv">\
                        <div class="leaderImage">\
                            <img :src="ministry.LeaderPic" class="img-responsive" :alt="ministry.Leader"  />\
                            <p>{{ministry.Title}} Leader: {{ministry.Leader}}</p>\
                            <button type="button" class="btn btn-primary" @click="showEmail()">Email: {{ministry.Leader}}</button>\
                        </div>\
                        <div class="ministryInfo">\
                            <h4>{{ministry.Title}} @ BTCOG</h4>\
                            <p>{{ministry.Content}}</p>\
                        </div>\
                    </div>\
                    <div class="bottomNav" :class="{ _flexend: End, _flexstart: Start, _flexbetween: Space }">\
                        <span v-if="Prev > -1" class="prev" :title="PrevTitle"  @click="gotoMinistry(Prev)"><i class="fa fa-backward fa-3x" aria-hidden="true"></i><span class="nav"> Prev </span></span><span v-if="Next > -1" :title="NextTitle"  class="next" @click="gotoMinistry(Next)"><span class="nav"> Next </span><i class="fa fa-forward fa-3x" aria-hidden="true"></i></span>\
                    </div>\
                    <b-modal ref="modallg" size="lg" :title="emailTitle(ministry.Title)" no-close-on-backdrop >\
                        <div class="modaldiv">\
                            <div><span>TO:</span> <span>{{ministry.Leader}}</span></div>\
                            <div><span>FROM:</span> <input type="text" ref="email" v-model="fromEmail" placeholder="Your email address" /></div>\
                            <div><span>MESSAGE:</span><br />\
                            <textarea cols="80" rows="10" v-model="message" /></div>\
                        </div>\
                        <div slot="modal-footer"><b-button variant="outline-success" class="btn" @click="sendEmail(ministry.Leader, ministry.Title)">Send</b-button></div>\
                    </b-modal>\
                </div>',
    data: function(){
        return{
            fromEmail: "",
            message:""
        }
    },
    methods:{
        showEmail: function(){
            this.fromEmail = "";
            this.message = "";
            this.$refs.email.focus();
            this.$refs.modallg.show();
        },
        gotoMinistry: function(payload){
            store.dispatch('getMinistryData', payload);
        },
        emailTitle: function(payload){
            return "Email " + payload + " Leader";
        },
        sendEmail: function(payload, payload1){
            var mdl = this.$refs.modallg;
            if (this.fromEmail == "")
            {
                alert("You must enter a email address");
                return false;
            }
            if (this.message == "")
            {
                alert("You have not entered any message");
                return false;
            }
            var _data = { '__metadata': { 'type': 'SP.Data.EmailReceivedListItem'} };
            _data["Title"] = payload;
            _data["FromEmail"] = this.fromEmail;
            _data["Message"] = this.message;
            _data["Leader"] = payload1;    
            var _url = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('EmailReceived')/items";
            $.ajax({
                url : _url,
                method: "POST",
                contentType: "application/json; odata=verbose",
                data: JSON.stringify(_data),
                headers: { "Accept": "application/json; odata=verbose",
                        "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                        },
                success: function(data){
                    alert("Email sent");
                    mdl.hide();
                },
                error: function(data){
                    console.log(data);
                }
            });
        }
    },
    computed:{
        ministry: function () {
            return store.getters.getCurrentMinistry[0];
          },
        HeaderImage: function () {
            return "url(" + this.ministry.Banner + ")";
        },
        Next: function() {
            return store.getters.getNextMinistry;
        },
        Prev: function () {
            return store.getters.getPrevMinistry;
        },
        Space: function () {
            if (this.ministry.ID > 1 && this.ministry.ID < 10) 
                return true;
            else
                return false;
        },
        End: function () {
            if (this.ministry.ID == 1)
                return true;
            else
                return false;
        },
        Start: function () {
            if (this.ministry.ID == 10)
                return true;
            else
                return false;
        },
        ministries: function () {
            return store.getters.ministriesSelected;
        },
        PrevTitle: function(){
            return store.getters.getPrevMinistryTitle;
        },
        NextTitle: function(){
            return store.getters.getNextMinistryTitle;
        }
    },
    watch:{
        ministry: function(){
            $('#s4-workspace').scrollTop(0);
        }
    }
});

var app = new Vue({
    el: "#appMinistry"
});

function sendMessage(leader, title, fromEmail, message)
{
    var _data = { '__metadata': { 'type': 'SP.Data.EmailReceivedListItem'} };
    _data["Title"] = title;
    _data["FromEmail"] = fromEmail;
    _data["Message"] = message;
    _data["Leader"] = leader;    
    var _url = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('EmailReceived')/items";
    $.ajax({
        url : _url,
        method: "POST",
        contentType: "application/json; odata=verbose",
        data: JSON.stringify(_data),
        headers: { "Accept": "application/json; odata=verbose",
                   "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                },
        success: function(data){
            alert("Email sent");
        },
        error: function(data){
            console.log(data);
        }
    });
}

</script>

<!-- <link href="https://unpkg.com/vuetify/dist/vuetify.min.css" rel="stylesheet"> -->
<style>
/*Page*/
._flexend
{
    justify-content: flex-end;
}
._flexstart
{
    justify-content:flex-start;
}
._flexbetween
{
    justify-content: space-between;
}
#s4-workspace
{
    border-top: 1px solid darkgrey;
}
div#ministries
{
    padding:10px;
    max-width: 1140px;
    width: 100%;
    margin: auto;
    display: flex;
    -webkit-flex-flow: row wrap;
    -ms-flex-flow: row wrap;
    flex-flow: row wrap;
    justify-content: space-between;
    background: #fff;
}
/*minstries*/
.ministryDetails {
    max-width: 340px;
    padding: 10px;
    cursor: pointer;
    max-height: 300px;
}
.ministryImage, .ministryImage img {
    width: 340px;
    height: 300px;
}
.ministryDetails:hover
{
	background:#C25632;
	opacity: .6;
}
/*ministry*/
.banner
{
    width:100%;
    height: 300px;
    background-size: cover;
}
.banner .h1div
{
    margin: auto;
    width:100%;
    font-size:2rem;
    background:#000;
    opacity: .6;
    position: fixed;
    height: 50px;
}
h1.hTitle
{
    max-width: 1140px;
    width: 100%;
    margin:auto;
    color:#fff;
    font-size: 2rem;
}
div.ministrydiv
{
	display:flex;
	display:-webkit-flex;
	max-width: 1120px;
    width:auto;
    margin: auto;
    -ms-flex-flow: row wrap;
    -webkit-flex-flow: row wrap;
    flex-flow: row wrap;
    padding: 10px;
    background: #fff;
}
div.leaderImage img
{	
	padding:20px;
}
div.leaderImage img
{
	border-radius: 250px;
    max-width: 250px;
    width: 100%;
    max-height:250px;
}
div.leaderImage
{
	text-align:center;
    padding:10px;
    max-width: 300px;
    width: 100%;
}
div.ministryInfo
{
	max-width: 600px;
    width: auto;
    padding: 20px;
    border-left: 1px solid lightgrey;
    flex:1;
}
div.ministrydiv .btn
{
	padding: .5rem 1rem;
	cursor:pointer;
}
div.ministryInfo p
{
    padding-right:10px;
}
.bottomNav
{
    max-width: 1120px;
    width:auto;
    margin:auto;
    position: relative;
    padding:10px;
    display: flex;
    -webkit-flex-flow:row wrap;
    -ms-flex-flow:row wrap;
    flex-flow:row wrap;
    background: #fff;
}
.bottomNav span
{
    display: flex;
    cursor: pointer;
    color:darkgrey;
}
.bottomNav span:hover
{
    color:#8796A0;
}
.nav
{
    padding:10px;
}
.prev button, .next button
{
    cursor: pointer;
    color:#fff;
}
.prev a:link, .prev a:visited, .next a:link, .next a:visited
{
    color:#fff;
}
.modal-header
{
    padding:0;
    height: 40px;
}
.modal-header h5
{
    margin-top: 0;
    color: #000;
    text-decoration: none;
    cursor: default;
    width:auto;
}
@media (max-width:636px)
{
    .banner
    {
        height: 200px;
    }
}
@media (max-width:425px)
{
    .banner
    {
        height: 150px;
    }
}
@media (max-width:680px)
{
    div.ministrydiv
    {
        -ms-flex-flow:column;
        -webkit-flex-flow: column;
        flex-flow: column;
        justify-content: center;
    }
    div.ministryInfo h4,  div.ministryInfo p
    {
        text-align: center;
    }
    div.ministryInfo
    {
        padding:0;
        border-left: none;
    }
}
</style>